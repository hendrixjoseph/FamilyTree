--------------------------------------------------------
--  DDL for View SPOUSE_VIEW
--------------------------------------------------------

  CREATE OR REPLACE VIEW "SPOUSE_VIEW" ("ID", "NAME", "SPOUSE_ID", "SPOUSE") AS 
  SELECT DISTINCT
    P.ID,
	  P.NAME,
    SPOUSE.ID AS SPOUSE_ID,
    SPOUSE.NAME AS SPOUSE
FROM 
    PERSON_VIEW CHILD
INNER JOIN 
    PERSON_VIEW P
ON
    CHILD.FATHER_ID = P.ID OR CHILD.MOTHER_ID = P.ID
LEFT OUTER JOIN
    PERSON_VIEW SPOUSE
ON
    (CHILD.FATHER_ID = SPOUSE.ID OR CHILD.MOTHER_ID = SPOUSE.ID) AND
    P.ID <> SPOUSE.ID
UNION
SELECT     
    P.HUSBAND_ID AS ID,
	  P.HUSBAND_NAME AS NAME,
    P.WIFE_ID AS SPOUSE_ID,
    P.WIFE_NAME AS SPOUSE
FROM
MARRIAGE_VIEW P
UNION
SELECT     
    P.WIFE_ID AS ID,
	  P.WIFE_NAME AS NAME,
    P.HUSBAND_ID AS SPOUSE_ID,
    P.HUSBAND_NAME AS SPOUSE
FROM
MARRIAGE_VIEW P;
